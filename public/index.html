<!DOCTYPE html>
<html lang="ko">
    <head>
        <title></title>
        <meta charset = "utf-8"/>
        <script src="/socket.io/socket.io.js"></script>
        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
     <!--반응형 웹, 부트스트랩-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <!--blockly-->
    <script src="../blockly_test/blockly_compressed.js"></script>
   <script src="../blockly_test/blocks_compressed.js"></script>
   <script src="../blockly_test/javascript_compressed.js"></script>
   <script src="../blockly_test/msg/js/en.js"></script>

   <script src="script/customblocks.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    #circle{
      height: 300px;
      width: 300px;
      border-radius: 50%;
      background-color:white;
      border: solid 1px black;
      position: absolute;
      
    }
  </style>

    </head>
    <body>
       <!-- 상단 메뉴 바 -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./index.html">Bootstrap</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="">
                <a href="./index.html">Home</a>
              </li>
              <li class="active">
                <a href="./getting-started.html">Get started</a>
              </li>
              <li class="">
                <a href="./scaffolding.html">Scaffolding</a>
              </li>
              <li class="">
                <a href="./base-css.html">Base CSS</a>
              </li>
              <li class="">
                <a href="./components.html">Components</a>
              </li>
              <li class="">
                <a href="./javascript.html">JavaScript</a>
              </li>
              <li class="">
                <a href="./customize.html">Customize</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
 <!-- 구조 -->
 <div class="row" style="padding-top: 60px;">
  <div class="span5" style="border-right: solid 1px black; padding-left: 20px;"> 
   <!-- added to the page -->
  <div id="circle"></div>
  
  <b>Send message</b><p>
        Message  <input type="text" id="msgbox"/>
        <br>
        <span id="msgs"></span> </div>

  <div class="span7">
   
   <!-- button to run code -->
  <p>
    <button onclick="runCode()">Run JavaScript</button>
  </p>
  <!-- TOOL BOX -->
  <div id="blocklyDiv" style="height: 460px; width: 600px;"></div>

  <xml id="toolbox" style="display: none;">
    <category name="Logic">
      <block type="lightswitch">
        <field name="lightcolor">red</field>
        <field name="switch">on</field>
      </block>
    </category>
  </xml>
   </div>

  

 

  <script>
  //put the toolbox in the workspace
  var workspace =Blockly.inject('blocklyDiv',
    {media: '../../media/',
    toolbox: document.getElementById('toolbox')});

  // take the text generated by the blocks and run it as code
  function runCode() {
    window.LoopTrap = 1000;
    Blockly.JavaScript.INFINITE_LOOP_TRAP =
      'if(--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try{
        eval(code);
      }catch(e) {
        alert(e);
      }
  } 
  
  </script>
</div>  







        <script type="text/javascript">
            var Request = function()
            {
                this.getParameter = function( name )
                {
                    var rtnval = '';
                    var nowAddress = unescape(location.href);
                    var parameters = (nowAddress.slice(nowAddress.indexOf('?')+1,nowAddress.length)).split('&');

                    for(var i = 0 ; i < parameters.length ; i++)
                    {
                        var varName = parameters[i].split('=')[0];
                        if(varName.toUpperCase() == name.toUpperCase())
                        {
                            rtnval = parameters[i].split('=')[1];
                            break;
                        }
                    }
                    return rtnval;
                }
            }
            var request = new Request();

            var uid = request.getParameter('uid') ;
            var room = request.getParameter('room');
    
            var socket = io.connect('http://localhost:8080');
    
            socket.emit('init',{room:room});

            $("#msgbox").keyup(function(event) { //메세지 박스 입력될때
                if (event.which == 13) {
                    socket.emit('fromclient',{uid:uid, msg:$('#msgbox').val(),room:room});//fromclient emit
                    $('#msgbox').val('');
                }
            });
            socket.on('toclient',function(data){//toclient emit
                if(data.room==room) //현재 클라이언트와 전달받은 데이터의 방이 일치할 때
                    $('#msgs').append(data.uid + " : " +data.msg+'<BR>'); // 데이터 출력
            });
        </script>
        <script src="http://code.jquery.com/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    </body>
</html>
    